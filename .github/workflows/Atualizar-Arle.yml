name: Galaxy M55 Kernel Release (Android 14)

on:
  workflow_dispatch:

jobs:
  release:
    runs-on: ubuntu-latest

    permissions:
      contents: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Create or update tag
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "github-actions@github.com"
          git tag -f v1.0-android14-kernelsu-next
          git push -f origin v1.0-android14-kernelsu-next

      - name: Download boot image from SourceForge
        run: |
          mkdir -p artifacts
          wget -O artifacts/boot-m55-android14-kernelsu-next-v3.img \
          "https://downloads.sourceforge.net/project/sm-m556b-14-kernelsu-next/android14/KernelSU-Next/boot-m55-android14-kernelsu-next-v3.img"

      - name: Validate boot image
        run: |
          FILE="artifacts/boot-m55-android14-kernelsu-next-v3.img"
          echo "Tipo:"
          file "$FILE"
          if file "$FILE" | grep -qi "HTML"; then
            echo "ERRO: Arquivo inv√°lido (HTML em vez do boot.img)"
            exit 1
          fi
          SIZE=$(stat -c%s "$FILE")
          if [ "$SIZE" -lt 50000000 ]; then
            echo "ERRO: Arquivo muito pequeno"
            exit 1
          fi

      - name: Create or update GitHub Release and upload asset
        uses: softprops/action-gh-release@v2
        with:
          tag_name: v1.0-android14-kernelsu-next
          name: Galaxy M55 ‚Ä¢ Android 14 ‚Ä¢ KernelSU Next v3
          body: |
            # Samsung Galaxy M55 Kernel (SM-M556B)
            **Android:** 14 (One UI 6.1)  
            **Root:** KernelSU Next v3  
            **Base:** Samsung Stock Kernel

            ## üì¶ Download
            O arquivo `.img` j√° est√° dispon√≠vel nos **Assets deste Release**.

            ## üîê Root
            Root via **KernelSU Next v3** integrado ao kernel.

            ## üôè Agradecimentos
            Agradecimentos especiais a:
            **Tiann** ‚Äî criador do KernelSU ‚Äî https://github.com/tiann  
            Projetos:
            - KernelSU ‚Äî https://github.com/tiann/KernelSU  
            - KernelSU Next ‚Äî https://github.com/KernelSU-Next  
            Colabora√ß√µes:
            - **Fernanda** (GitHub: DevzPlayer) ‚Äî contribui√ß√µes t√©cnicas  
            - **rifsxd** ‚Äî suporte ao kernel Android

            ‚ö†Ô∏è Destinado a usu√°rios avan√ßados.  
            Use por sua conta e risco.
          files: |
            artifacts/boot-m55-android14-kernelsu-next-v3.img
          draft: false
          prerelease: false
