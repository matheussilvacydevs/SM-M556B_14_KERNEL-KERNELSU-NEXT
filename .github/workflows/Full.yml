name: Galaxy M55 Kernel Release (Android 14)

on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  release:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Create or update tag
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "github-actions@github.com"
          git tag -f v1.0-android14-kernelsu-next
          git push -f origin v1.0-android14-kernelsu-next

      - name: Download boot.img from SourceForge
        run: |
          mkdir -p artifacts
          wget \
            --content-disposition \
            --trust-server-names \
            --retry-connrefused \
            --waitretry=5 \
            --tries=5 \
            --timeout=30 \
            -O artifacts/boot-m55-android14-kernelsu-next-v3.img \
            "https://downloads.sourceforge.net/project/sm-m556b-14-kernelsu-next/android14/KernelSU-Next/boot-m55-android14-kernelsu-next-v3.img"

      - name: Validate boot image
        run: |
          FILE="artifacts/boot-m55-android14-kernelsu-next-v3.img"
          echo "Tipo do arquivo:"
          file "$FILE"

          if file "$FILE" | grep -qi "HTML"; then
            echo "ERRO: Download retornou HTML (SourceForge redirect)"
            exit 1
          fi

          SIZE=$(stat -c%s "$FILE")
          echo "Tamanho: $SIZE bytes"

          if [ "$SIZE" -lt 50000000 ]; then
            echo "ERRO: Arquivo muito pequeno para ser boot.img"
            exit 1
          fi

      - name: Create GitHub Release and upload asset
        uses: softprops/action-gh-release@v2
        with:
          tag_name: v1.0-android14-kernelsu-next
          name: Galaxy M55 ‚Ä¢ Android 14 ‚Ä¢ KernelSU Next v3
          body: |
            ## Samsung Galaxy M55 (SM-M556B)

            **Android:** 14 (One UI 6.1)  
            **Kernel:** Stock Samsung  
            **Root:** KernelSU Next v3  

            ### üì¶ Arquivo
            - boot-m55-android14-kernelsu-next-v3.img

            ### üôè Agradecimentos
            **Tiann** ‚Äî criador do KernelSU  
            https://github.com/tiann  

            Projetos:
            - KernelSU ‚Äî https://github.com/tiann/KernelSU
            - KernelSU Next ‚Äî https://github.com/KernelSU-Next

            Contribui√ß√µes:
            - **Fernanda** (DevzPlayer)
            - **rifsxd**

            ‚ö†Ô∏è Uso por sua conta e risco.
          files: artifacts/boot-m55-android14-kernelsu-next-v3.img
